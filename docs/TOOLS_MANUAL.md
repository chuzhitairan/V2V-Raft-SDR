# V2V-Raft-SDR å·¥å…·ä½¿ç”¨æ‰‹å†Œ

æœ¬é¡¹ç›®åŒ…å«ç”¨äº V2V (Vehicle-to-Vehicle) é€šä¿¡çš„ SDR å·¥å…·é›†ï¼ŒåŸºäº GNU Radio å’Œ gr-ieee802-11 å®ç° IEEE 802.11p OFDM PHY å±‚ã€‚

---

## ğŸ“ ç›®å½•ç»“æ„

```
V2V-Raft-SDR/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ app/                    # åº”ç”¨å±‚è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ full_auto_benchmark.py   # å…¨è‡ªåŠ¨åŸºå‡†æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ plot_csv.py              # CSV æ•°æ®ç»˜å›¾
â”‚   â”‚   â”œâ”€â”€ raft_node.py             # Raft å…±è¯†èŠ‚ç‚¹ (å¤šèŠ‚ç‚¹)
â”‚   â”‚   â”œâ”€â”€ raft_node_single.py      # Raft èŠ‚ç‚¹ (å•æ¿æµ‹è¯•)
â”‚   â”‚   â””â”€â”€ simple_test.py           # ç®€å•æ”¶å‘æµ‹è¯•
â”‚   â”œâ”€â”€ core/                   # æ ¸å¿ƒ PHY å±‚
â”‚   â”‚   â”œâ”€â”€ v2v_hw_phy.py            # ç¡¬ä»¶ SDR PHY
â”‚   â”‚   â”œâ”€â”€ v2v_sim_hub.py           # ä»¿çœŸ Hub (å®Œæ•´ç‰ˆ)
â”‚   â”‚   â”œâ”€â”€ sim_hub_lite.py          # ä»¿çœŸ Hub (è½»é‡ç‰ˆ)
â”‚   â”‚   â””â”€â”€ wifi_phy_hier.py         # WiFi PHY å±‚æ¬¡å—
â”‚   â””â”€â”€ run_sim.sh              # å¤šèŠ‚ç‚¹ä»¿çœŸå¯åŠ¨è„šæœ¬
â”œâ”€â”€ results/
â”‚   â”œâ”€â”€ csv/                    # æµ‹è¯•æ•°æ® (CSV)
â”‚   â”œâ”€â”€ plots/                  # å›¾è¡¨ (PNG)
â”‚   â””â”€â”€ reports/                # åˆ†ææŠ¥å‘Š (Markdown)
â””â”€â”€ grc/                        # GNU Radio Companion æ–‡ä»¶
```

---

## ğŸ”§ ç¯å¢ƒè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Ubuntu 22.04 / 24.04
- **Python**: 3.10+
- **GNU Radio**: 3.10+
- **gr-ieee802-11**: å·²å®‰è£…
- **SDR ç¡¬ä»¶**: ANTSDR E200 (AD9361) æˆ–å…¼å®¹è®¾å¤‡
- **Python åŒ…**: `matplotlib` (ç»˜å›¾éœ€è¦)

```bash
# å®‰è£… matplotlib
sudo apt install python3-matplotlib
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¡¬ä»¶åŸºå‡†æµ‹è¯• (æ¨è)

æµ‹è¯• TX Gain ä¸ SNRã€ä¸¢åŒ…ç‡çš„å…³ç³»ï¼š

```bash
# ç»ˆç«¯ 1: å¯åŠ¨ SDR PHY å±‚
sudo python3 scripts/core/v2v_hw_phy.py \
    --serial-num "addr=192.168.1.10" \
    --tx-gain 0.5 --rx-gain 0.5 \
    --ctrl-port 9999

# ç»ˆç«¯ 2: è¿è¡Œè‡ªåŠ¨æµ‹è¯•
python3 scripts/app/full_auto_benchmark.py \
    --rx-gain 0.5 \
    --tx-range 0.1 0.9 0.05 \
    --packets 100
```

### 2. ä» CSV ç»˜å›¾

```bash
python3 scripts/app/plot_csv.py results/csv/auto_benchmark_xxx.csv
```

### 3. è½¯ä»¶ä»¿çœŸ (æ— éœ€ç¡¬ä»¶)

```bash
./scripts/run_sim.sh
```

---

## ğŸ“š å·¥å…·è¯¦ç»†è¯´æ˜

---

### 1. `v2v_hw_phy.py` - ç¡¬ä»¶ PHY å±‚

GNU Radio æµå›¾ï¼Œå®ç° IEEE 802.11p OFDM æ”¶å‘ã€‚

**å¯åŠ¨å‘½ä»¤**:
```bash
sudo python3 scripts/core/v2v_hw_phy.py [é€‰é¡¹]
```

**å‚æ•°è¯´æ˜**:
| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--serial-num` | `""` | SDR è®¾å¤‡åœ°å€ï¼Œå¦‚ `"addr=192.168.1.10"` |
| `--tx-gain` | `0.75` | å‘å°„å¢ç›Š (0.0 - 1.0) |
| `--rx-gain` | `0.75` | æ¥æ”¶å¢ç›Š (0.0 - 1.0) |
| `--freq` | `5.89e9` | ä¸­å¿ƒé¢‘ç‡ (Hz)ï¼Œé»˜è®¤ 5.89 GHz |
| `--bandwidth` | `10e6` | å¸¦å®½ (Hz)ï¼Œé»˜è®¤ 10 MHz |
| `--lo-offset` | `0` | æœ¬æŒ¯åç§» (Hz) |
| `--ctrl-port` | `9999` | UDP æ§åˆ¶ç«¯å£ (åŠ¨æ€è°ƒæ•´å¢ç›Š) |

**UDP ç«¯å£**:
- **10000**: å‘é€æ•°æ® (åº”ç”¨å±‚ â†’ PHY)
- **20000**: æ¥æ”¶æ•°æ® (PHY â†’ åº”ç”¨å±‚)
- **9999**: æ§åˆ¶ç«¯å£ (åŠ¨æ€å¢ç›Šè°ƒæ•´)

**æ§åˆ¶å‘½ä»¤ç¤ºä¾‹** (å‘é€ JSON åˆ° UDP 9999):
```python
import socket, json

sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

# è®¾ç½® TX Gain
sock.sendto(json.dumps({"cmd": "set_tx_gain", "value": 0.6}).encode(), 
            ("127.0.0.1", 9999))

# è®¾ç½® RX Gain
sock.sendto(json.dumps({"cmd": "set_rx_gain", "value": 0.5}).encode(), 
            ("127.0.0.1", 9999))

# æŸ¥è¯¢å½“å‰å¢ç›Š
sock.sendto(json.dumps({"cmd": "get_gains"}).encode(), ("127.0.0.1", 9999))
```

---

### 2. `full_auto_benchmark.py` - å…¨è‡ªåŠ¨åŸºå‡†æµ‹è¯•

è‡ªåŠ¨æ‰«æ TX Gain èŒƒå›´ï¼Œæµ‹é‡ SNR å’Œä¸¢åŒ…ç‡ã€‚

**ä½¿ç”¨æ–¹æ³•**:
```bash
python3 scripts/app/full_auto_benchmark.py [é€‰é¡¹]
```

**å‚æ•°è¯´æ˜**:
| å‚æ•° | å¿…éœ€ | è¯´æ˜ |
|------|------|------|
| `--rx-gain` | âœ… | å›ºå®šçš„ RX Gain å€¼ |
| `--tx-range START END STEP` | âœ… | TX Gain æ‰«æèŒƒå›´ |
| `--packets` | âŒ | æ¯ç‚¹å‘é€åŒ…æ•° (é»˜è®¤ 100) |
| `--interval` | âŒ | å‘åŒ…é—´éš”ç§’æ•° (é»˜è®¤ 0.02) |
| `--output` | âŒ | è¾“å‡ºç›®å½• (é»˜è®¤ `results`) |
| `--ctrl-port` | âŒ | PHY æ§åˆ¶ç«¯å£ (é»˜è®¤ 9999) |

**ç¤ºä¾‹**:
```bash
# æ‰«æ TX Gain 0.1 åˆ° 0.9ï¼Œæ­¥é•¿ 0.05
python3 scripts/app/full_auto_benchmark.py \
    --rx-gain 0.5 \
    --tx-range 0.1 0.9 0.05 \
    --packets 200

# å¿«é€Ÿæµ‹è¯• (è¾ƒå°‘æ•°æ®ç‚¹)
python3 scripts/app/full_auto_benchmark.py \
    --rx-gain 0.5 \
    --tx-range 0.3 0.7 0.1 \
    --packets 50
```

**è¾“å‡ºæ–‡ä»¶**:
- `results/csv/auto_benchmark_YYYYMMDD_HHMMSS.csv`
- `results/plots/auto_benchmark_YYYYMMDD_HHMMSS.png`

---

### 3. `plot_csv.py` - CSV æ•°æ®ç»˜å›¾

ä» CSV æ–‡ä»¶ç”Ÿæˆ 6 å¼ ç»¼åˆåˆ†æå›¾è¡¨ã€‚

**ä½¿ç”¨æ–¹æ³•**:
```bash
python3 scripts/app/plot_csv.py <CSVæ–‡ä»¶> [é€‰é¡¹]
```

**å‚æ•°è¯´æ˜**:
| å‚æ•° | è¯´æ˜ |
|------|------|
| `csv_file` | CSV æ–‡ä»¶è·¯å¾„ (å¿…éœ€) |
| `--output, -o` | è¾“å‡ºå›¾ç‰‡è·¯å¾„ (é»˜è®¤: åŒå_plot.png) |
| `--no-show` | ä¸æ˜¾ç¤ºå›¾è¡¨çª—å£ï¼Œåªä¿å­˜æ–‡ä»¶ |

**ç¤ºä¾‹**:
```bash
# ç»˜å›¾å¹¶æ˜¾ç¤º
python3 scripts/app/plot_csv.py results/csv/auto_benchmark_20260118_173331.csv

# æŒ‡å®šè¾“å‡ºè·¯å¾„
python3 scripts/app/plot_csv.py results/csv/data.csv -o results/plots/my_analysis.png

# ä»…ä¿å­˜ä¸æ˜¾ç¤º
python3 scripts/app/plot_csv.py results/csv/data.csv --no-show
```

**æ”¯æŒçš„ CSV æ ¼å¼**:
- `full_auto_benchmark.py` è¾“å‡ºæ ¼å¼
- `manual_benchmark.py` è¾“å‡ºæ ¼å¼ (æ—§ç‰ˆ)

---

### 4. `raft_node.py` - Raft å…±è¯†èŠ‚ç‚¹

å®ç° Raft å…±è¯†ç®—æ³•ï¼Œæ”¯æŒå¤šèŠ‚ç‚¹åˆ†å¸ƒå¼ä¸€è‡´æ€§ã€‚

**ä½¿ç”¨æ–¹æ³•**:
```bash
python3 scripts/app/raft_node.py --node-id <ID> --peers <PEER1> <PEER2> ...
```

**å‚æ•°è¯´æ˜**:
| å‚æ•° | è¯´æ˜ |
|------|------|
| `--node-id` | å½“å‰èŠ‚ç‚¹ ID (å¦‚ `node1`) |
| `--peers` | å…¶ä»–èŠ‚ç‚¹ ID åˆ—è¡¨ |
| `--hub-host` | Hub ä¸»æœºåœ°å€ (é»˜è®¤ `127.0.0.1`) |
| `--hub-port` | Hub ç«¯å£ (é»˜è®¤ `6000`) |

**ç¤ºä¾‹ (3 èŠ‚ç‚¹é›†ç¾¤)**:
```bash
# ç»ˆç«¯ 1: å¯åŠ¨ Hub
python3 scripts/core/sim_hub_lite.py

# ç»ˆç«¯ 2: èŠ‚ç‚¹ 1
python3 scripts/app/raft_node.py --node-id node1 --peers node2 node3

# ç»ˆç«¯ 3: èŠ‚ç‚¹ 2
python3 scripts/app/raft_node.py --node-id node2 --peers node1 node3

# ç»ˆç«¯ 4: èŠ‚ç‚¹ 3
python3 scripts/app/raft_node.py --node-id node3 --peers node1 node2
```

**äº¤äº’å‘½ä»¤**:
```
propose <value>   - æè®®ä¸€ä¸ªå€¼ (éœ€è¦æ˜¯ Leader)
status           - æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€
quit             - é€€å‡º
```

---

### 5. `raft_node_single.py` - å•æ¿ Raft æµ‹è¯•

ç”¨äºå•å— SDR æ¿å­çš„è‡ªå›ç¯æµ‹è¯•ã€‚

**ä½¿ç”¨æ–¹æ³•**:
```bash
python3 scripts/app/raft_node_single.py
```

**è¯´æ˜**: ä¸»è¦ç”¨äºéªŒè¯ PHY å±‚é€šä¿¡ï¼Œé€šè¿‡è‡ªå‘è‡ªæ”¶æµ‹è¯•ã€‚

---

### 6. `simple_test.py` - ç®€å•æ”¶å‘æµ‹è¯•

æœ€åŸºç¡€çš„ UDP æ”¶å‘æµ‹è¯•è„šæœ¬ã€‚

**ä½¿ç”¨æ–¹æ³•**:
```bash
python3 scripts/app/simple_test.py
```

---

### 7. `sim_hub_lite.py` - è½»é‡ä»¿çœŸ Hub

è½¯ä»¶ä»¿çœŸçš„æ¶ˆæ¯ä¸­è½¬ Hubï¼Œæ— éœ€ç¡¬ä»¶å³å¯æµ‹è¯•ã€‚

**ä½¿ç”¨æ–¹æ³•**:
```bash
python3 scripts/core/sim_hub_lite.py [--port 6000]
```

**å‚æ•°è¯´æ˜**:
| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--port` | `6000` | ç›‘å¬ç«¯å£ |

---

### 8. `run_sim.sh` - å¤šèŠ‚ç‚¹ä»¿çœŸå¯åŠ¨

ä½¿ç”¨ tmux ä¸€é”®å¯åŠ¨ 3 èŠ‚ç‚¹ä»¿çœŸç¯å¢ƒã€‚

**ä½¿ç”¨æ–¹æ³•**:
```bash
./scripts/run_sim.sh
```

**è¯´æ˜**: è‡ªåŠ¨åˆ›å»º tmux ä¼šè¯ï¼Œå¯åŠ¨ Hub å’Œ 3 ä¸ª Raft èŠ‚ç‚¹ã€‚

---

## ğŸ“Š æµ‹è¯•å·¥ä½œæµ

### å®Œæ•´ç¡¬ä»¶æµ‹è¯•æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å¯åŠ¨ SDR PHY                                              â”‚
â”‚    sudo python3 scripts/core/v2v_hw_phy.py --ctrl-port 9999 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. è¿è¡Œè‡ªåŠ¨æµ‹è¯•                                              â”‚
â”‚    python3 scripts/app/full_auto_benchmark.py ...           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æŸ¥çœ‹ç»“æœ                                                  â”‚
â”‚    - CSV: results/csv/auto_benchmark_xxx.csv                â”‚
â”‚    - å›¾è¡¨: results/plots/auto_benchmark_xxx.png              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. (å¯é€‰) é‡æ–°ç»˜å›¾                                           â”‚
â”‚    python3 scripts/app/plot_csv.py results/csv/xxx.csv      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è½¯ä»¶ä»¿çœŸæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ä¸€é”®å¯åŠ¨                                                  â”‚
â”‚    ./scripts/run_sim.sh                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. åœ¨ä»»æ„èŠ‚ç‚¹çª—å£æ“ä½œ                                         â”‚
â”‚    propose hello     (æè®®å€¼)                                â”‚
â”‚    status           (æŸ¥çœ‹çŠ¶æ€)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” å¸¸è§é—®é¢˜

### Q: matplotlib æŠ¥é”™ "TkAgg backend" æ‰¾ä¸åˆ°ï¼Ÿ
```bash
sudo apt install python3-tk python3-matplotlib
```

### Q: SDR è¿æ¥å¤±è´¥ï¼Ÿ
1. æ£€æŸ¥ç½‘ç»œè¿æ¥: `ping 192.168.1.10`
2. æ£€æŸ¥ USB/ä»¥å¤ªç½‘æƒé™
3. ä½¿ç”¨ `sudo` è¿è¡Œ PHY è„šæœ¬

### Q: SNR å…¨æ˜¯ 0ï¼Ÿ
gr-ieee802-11 éœ€è¦æ­£ç¡®é…ç½®æ‰èƒ½è¾“å‡º SNR å…ƒæ•°æ®ã€‚æ£€æŸ¥:
1. PHY å±‚æ˜¯å¦æ­£å¸¸è§£è°ƒ
2. æ˜¯å¦æœ‰åŒ…æˆåŠŸæ¥æ”¶

### Q: å¦‚ä½•é€‰æ‹©æœ€ä½³å¢ç›Šï¼Ÿ
å‚è€ƒ `results/reports/analysis_xxx.md`ï¼Œé€šå¸¸:
- **TX Gain 0.50-0.60** æœ€ä½³ (RX Gain = 0.5 æ—¶)
- è¿‡ä½: ä¿¡å·å¤ªå¼±ï¼Œæ— æ³•è§£è°ƒ
- è¿‡é«˜: æ¥æ”¶ç«¯é¥±å’Œï¼Œå¤±çœŸå¢åŠ 

---

## ğŸ“ é™„å½•: å…³é”®å‚æ•°æ¨è

åŸºäºæµ‹è¯•ç»“æœçš„æ¨èé…ç½® (RX Gain = 0.5):

| å‚æ•° | æ¨èå€¼ | è¯´æ˜ |
|------|--------|------|
| TX Gain | 0.55 | æœ€ä½³ç‚¹ |
| TX Gain èŒƒå›´ | 0.40 - 0.65 | å®‰å…¨èŒƒå›´ |
| SNR ä¼˜ç§€é˜ˆå€¼ | > 20 dB | å¯ç¼©çŸ­ Raft è¶…æ—¶ |
| SNR å¯ç”¨é˜ˆå€¼ | > 8 dB | æœ€ä½å¯ç”¨ |
| SNR é¥±å’Œé˜ˆå€¼ | > 30 dB | æ³¨æ„å¤±çœŸ |

---

*æœ€åæ›´æ–°: 2026-01-18*
