# V2V-Raft-SDR å·¥å…·ä½¿ç”¨æ‰‹å†Œ

æœ¬é¡¹ç›®åŒ…å«ç”¨äº V2V (Vehicle-to-Vehicle) é€šä¿¡çš„ SDR å·¥å…·é›†ï¼ŒåŸºäº GNU Radio å’Œ gr-ieee802-11 å®ç° IEEE 802.11p OFDM PHY å±‚ã€‚

---

## ğŸ“ ç›®å½•ç»“æ„

```
V2V-Raft-SDR/
â”œâ”€â”€ core/                       # æ ¸å¿ƒ PHY å±‚
â”‚   â”œâ”€â”€ v2v_hw_phy.py           # ç¡¬ä»¶ SDR PHY
â”‚   â”œâ”€â”€ v2v_sim_hub.py          # ä»¿çœŸ Hub (å®Œæ•´ç‰ˆ)
â”‚   â”œâ”€â”€ sim_hub_lite.py         # ä»¿çœŸ Hub (è½»é‡ç‰ˆ)
â”‚   â””â”€â”€ wifi_phy_hier.py        # WiFi PHY å±‚æ¬¡å—
â”‚
â”œâ”€â”€ experiments/                # å®éªŒä»£ç 
â”‚   â”œâ”€â”€ pre_test/               # åŸºå‡†æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ full_auto_benchmark.py
â”‚   â”‚   â””â”€â”€ plot_csv.py
â”‚   â”œâ”€â”€ snr_cluster_size/       # SNR-é›†ç¾¤è§„æ¨¡å®éªŒ
â”‚   â”‚   â””â”€â”€ code/
â”‚   â””â”€â”€ reliability_consensus/  # å¯é æ€§å…±è¯†å®éªŒ
â”‚       â””â”€â”€ code/
â”‚
â””â”€â”€ grc/                        # GNU Radio Companion æ–‡ä»¶
```

---

## ğŸ”§ ç¯å¢ƒè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Ubuntu 22.04 / 24.04
- **Python**: 3.10+
- **GNU Radio**: 3.10+
- **gr-ieee802-11**: å·²å®‰è£…
- **SDR ç¡¬ä»¶**: ANTSDR E200 (AD9361) æˆ–å…¼å®¹è®¾å¤‡
- **Python åŒ…**: `matplotlib` (ç»˜å›¾éœ€è¦)

```bash
# å®‰è£… matplotlib
sudo apt install python3-matplotlib
```

---

## ğŸ“š å·¥å…·è¯¦ç»†è¯´æ˜

---

### 1. `v2v_hw_phy.py` - ç¡¬ä»¶ PHY å±‚

GNU Radio æµå›¾ï¼Œå®ç° IEEE 802.11p OFDM æ”¶å‘ã€‚

**ä½ç½®**: `core/v2v_hw_phy.py`

**å¯åŠ¨å‘½ä»¤**:
```bash
sudo python3 core/v2v_hw_phy.py [é€‰é¡¹]
```

**å‚æ•°è¯´æ˜**:
| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--sdr-args` | `""` | SDR è®¾å¤‡åœ°å€ï¼Œå¦‚ `"addr=192.168.1.10"` |
| `--tx-gain` | `0.75` | å‘å°„å¢ç›Š (0.0 - 1.0) |
| `--rx-gain` | `0.75` | æ¥æ”¶å¢ç›Š (0.0 - 1.0) |
| `--udp-recv-port` | `10000` | æ¥æ”¶æ¥è‡ªåº”ç”¨å±‚çš„ UDP ç«¯å£ |
| `--udp-send-port` | `20000` | å‘é€åˆ°åº”ç”¨å±‚çš„ UDP ç«¯å£ |
| `--ctrl-port` | `9999` | UDP æ§åˆ¶ç«¯å£ (åŠ¨æ€è°ƒæ•´å¢ç›Š) |

**æ§åˆ¶å‘½ä»¤ç¤ºä¾‹** (å‘é€ JSON åˆ° UDP æ§åˆ¶ç«¯å£):
```python
import socket, json

sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

# è®¾ç½® TX Gain
sock.sendto(json.dumps({"cmd": "set_tx_gain", "value": 0.6}).encode(), 
            ("127.0.0.1", 9999))

# è®¾ç½® RX Gain
sock.sendto(json.dumps({"cmd": "set_rx_gain", "value": 0.5}).encode(), 
            ("127.0.0.1", 9999))

# æŸ¥è¯¢å½“å‰å¢ç›Š
sock.sendto(json.dumps({"cmd": "get_gains"}).encode(), ("127.0.0.1", 9999))
```

---

### 2. `sim_hub_lite.py` - è½»é‡ä»¿çœŸ Hub

çº¯ UDP è½¬å‘ï¼Œæ¨¡æ‹Ÿæ— çº¿å¹¿æ’­ä¿¡é“ï¼Œæ— éœ€ GNU Radioã€‚

**ä½ç½®**: `core/sim_hub_lite.py`

**å¯åŠ¨å‘½ä»¤**:
```bash
python3 core/sim_hub_lite.py [é€‰é¡¹]
```

**å‚æ•°è¯´æ˜**:
| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--nodes` | `5` | èŠ‚ç‚¹æ•°é‡ |
| `--port` | `50000` | ç›‘å¬ç«¯å£ |
| `--verbose` | `False` | æ˜¾ç¤ºè¯¦ç»†æ—¥å¿— |

**ç¤ºä¾‹**:
```bash
# å¯åŠ¨ 5 èŠ‚ç‚¹ä»¿çœŸ
python3 core/sim_hub_lite.py --nodes 5 --verbose
```

---

### 3. `v2v_sim_hub.py` - å®Œæ•´ä»¿çœŸ Hub

åŸºäº GNU Radio çš„ä»¿çœŸåŸºç«™ï¼ŒåŒ…å«å®Œæ•´ä¿¡é“æ¨¡å‹å’Œ GUIã€‚

**ä½ç½®**: `core/v2v_sim_hub.py`

**å¯åŠ¨å‘½ä»¤**:
```bash
python3 core/v2v_sim_hub.py
```

**è¯´æ˜**: å¯åŠ¨åä¼šæ˜¾ç¤º GNU Radio GUIï¼Œç›‘å¬ UDP 50000ï¼Œå¹¿æ’­åˆ° 50001-50005ã€‚

---

### 4. `full_auto_benchmark.py` - å…¨è‡ªåŠ¨åŸºå‡†æµ‹è¯•

è‡ªåŠ¨æ‰«æ TX Gain èŒƒå›´ï¼Œæµ‹é‡ SNR å’Œä¸¢åŒ…ç‡ã€‚

**ä½ç½®**: `experiments/pre_test/full_auto_benchmark.py`

**ä½¿ç”¨æ–¹æ³•**:
```bash
python3 experiments/pre_test/full_auto_benchmark.py [é€‰é¡¹]
```

**å‚æ•°è¯´æ˜**:
| å‚æ•° | å¿…éœ€ | è¯´æ˜ |
|------|------|------|
| `--rx-gain` | âœ… | å›ºå®šçš„ RX Gain å€¼ |
| `--tx-range START END STEP` | âœ… | TX Gain æ‰«æèŒƒå›´ |
| `--packets` | âŒ | æ¯ç‚¹å‘é€åŒ…æ•° (é»˜è®¤ 100) |
| `--interval` | âŒ | å‘åŒ…é—´éš”ç§’æ•° (é»˜è®¤ 0.02) |
| `--ctrl-port` | âŒ | PHY æ§åˆ¶ç«¯å£ (é»˜è®¤ 9999) |

**ç¤ºä¾‹**:
```bash
# æ‰«æ TX Gain 0.1 åˆ° 0.9ï¼Œæ­¥é•¿ 0.05
python3 experiments/pre_test/full_auto_benchmark.py \
    --rx-gain 0.5 \
    --tx-range 0.1 0.9 0.05 \
    --packets 200
```

**è¾“å‡ºæ–‡ä»¶**:
- `experiments/pre_test/results/csv/auto_benchmark_*.csv`
- `experiments/pre_test/results/plots/auto_benchmark_*.png`

---

### 5. `plot_csv.py` - CSV æ•°æ®ç»˜å›¾

ä» CSV æ–‡ä»¶ç”Ÿæˆåˆ†æå›¾è¡¨ã€‚

**ä½ç½®**: `experiments/pre_test/plot_csv.py`

**ä½¿ç”¨æ–¹æ³•**:
```bash
python3 experiments/pre_test/plot_csv.py <CSVæ–‡ä»¶> [é€‰é¡¹]
```

**å‚æ•°è¯´æ˜**:
| å‚æ•° | è¯´æ˜ |
|------|------|
| `csv_file` | CSV æ–‡ä»¶è·¯å¾„ (å¿…éœ€) |
| `--output, -o` | è¾“å‡ºå›¾ç‰‡è·¯å¾„ |
| `--no-show` | ä¸æ˜¾ç¤ºå›¾è¡¨çª—å£ï¼Œåªä¿å­˜æ–‡ä»¶ |

---

### 6. SNR-é›†ç¾¤è§„æ¨¡å®éªŒ

æµ‹é‡ä¸åŒ SNR ä¸‹ç³»ç»Ÿèƒ½æ”¯æ’‘çš„èŠ‚ç‚¹æ•°é‡ã€‚

**ä½ç½®**: `experiments/snr_cluster_size/code/`

**è„šæœ¬**:
- `raft_leader_snr_experiment.py` - Leader ç«¯
- `raft_follower_snr_experiment.py` - Follower ç«¯
- `run_snr_experiment.sh` - å¯åŠ¨è„šæœ¬
- `plot_snr_experiment.py` - ç»˜å›¾

**è¯¦è§**: [å®éªŒè¯´æ˜](../experiments/snr_cluster_size/README.md)

---

### 7. å¯é æ€§å…±è¯†å®éªŒ

è¯„ä¼°ç³»ç»Ÿå¯é æ€§ä¸èŠ‚ç‚¹å¯ä¿¡åº¦çš„å…³ç³»ã€‚

**ä½ç½®**: `experiments/reliability_consensus/code/`

**è„šæœ¬**:
- `raft_leader_reliability.py` - Leader ç«¯
- `raft_follower_reliability.py` - Follower ç«¯
- `run_reliability_experiment.sh` - å¯åŠ¨è„šæœ¬
- `plot_reliability.py` - ç»˜å›¾
- `sim_reliability.py` - çº¯è½¯ä»¶ä»¿çœŸ

**è¯¦è§**: [å®éªŒè¯´æ˜](../experiments/reliability_consensus/README.md)

---

## ğŸ“Š æµ‹è¯•å·¥ä½œæµ

### ç¡¬ä»¶æµ‹è¯•æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å¯åŠ¨ SDR PHY                                              â”‚
â”‚    sudo python3 core/v2v_hw_phy.py --ctrl-port 9999         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. è¿è¡Œè‡ªåŠ¨æµ‹è¯•                                              â”‚
â”‚    python3 experiments/pre_test/full_auto_benchmark.py ...  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æŸ¥çœ‹ç»“æœ                                                  â”‚
â”‚    - CSV: experiments/pre_test/results/csv/*.csv            â”‚
â”‚    - å›¾è¡¨: experiments/pre_test/results/plots/*.png         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è½¯ä»¶ä»¿çœŸæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å¯åŠ¨è½»é‡ Hub                                              â”‚
â”‚    python3 core/sim_hub_lite.py --nodes 5                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å¯åŠ¨ Leader (ç»ˆç«¯ 2)                                      â”‚
â”‚    python3 experiments/reliability_consensus/code/          â”‚
â”‚            raft_leader_reliability.py --id 1 --total 5 ...  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. å¯åŠ¨ Follower (ç»ˆç«¯ 3-6)                                  â”‚
â”‚    python3 experiments/reliability_consensus/code/          â”‚
â”‚            raft_follower_reliability.py --id 2 --total 5 ...â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” å¸¸è§é—®é¢˜

### Q: matplotlib æŠ¥é”™ "TkAgg backend" æ‰¾ä¸åˆ°ï¼Ÿ
```bash
sudo apt install python3-tk python3-matplotlib
```

### Q: SDR è¿æ¥å¤±è´¥ï¼Ÿ
1. æ£€æŸ¥ç½‘ç»œè¿æ¥: `ping 192.168.1.10`
2. æ£€æŸ¥ USB/ä»¥å¤ªç½‘æƒé™
3. ä½¿ç”¨ `sudo` è¿è¡Œ PHY è„šæœ¬

### Q: SNR å…¨æ˜¯ 0ï¼Ÿ
gr-ieee802-11 éœ€è¦æ­£ç¡®é…ç½®æ‰èƒ½è¾“å‡º SNR å…ƒæ•°æ®ã€‚æ£€æŸ¥:
1. PHY å±‚æ˜¯å¦æ­£å¸¸è§£è°ƒ
2. æ˜¯å¦æœ‰åŒ…æˆåŠŸæ¥æ”¶

### Q: å¦‚ä½•é€‰æ‹©æœ€ä½³å¢ç›Šï¼Ÿ
å‚è€ƒ `experiments/pre_test/results/reports/analysis_*.md`ï¼Œé€šå¸¸:
- **TX Gain 0.50-0.60** æœ€ä½³ (RX Gain = 0.5 æ—¶)
- è¿‡ä½: ä¿¡å·å¤ªå¼±ï¼Œæ— æ³•è§£è°ƒ
- è¿‡é«˜: æ¥æ”¶ç«¯é¥±å’Œï¼Œå¤±çœŸå¢åŠ 

---

## ğŸ“ é™„å½•: å…³é”®å‚æ•°æ¨è

åŸºäºæµ‹è¯•ç»“æœçš„æ¨èé…ç½® (RX Gain = 0.5):

| å‚æ•° | æ¨èå€¼ | è¯´æ˜ |
|------|--------|------|
| TX Gain | 0.55 | æœ€ä½³ç‚¹ |
| TX Gain èŒƒå›´ | 0.40 - 0.65 | å®‰å…¨èŒƒå›´ |
| SNR ä¼˜ç§€é˜ˆå€¼ | > 20 dB | å¯ç¼©çŸ­ Raft è¶…æ—¶ |
| SNR å¯ç”¨é˜ˆå€¼ | > 8 dB | æœ€ä½å¯ç”¨ |
| SNR é¥±å’Œé˜ˆå€¼ | > 30 dB | æ³¨æ„å¤±çœŸ |

---

*æœ€åæ›´æ–°: 2026-02-01*
