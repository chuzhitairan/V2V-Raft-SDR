# V2V-Raft-SDR: 基于 SDR 的车联网 Raft 共识算法实现 (极简仿真阶段)

## 项目简介
本项目旨在验证 **Wireless Distributed Consensus (无线分布式共识)** 理论在车联网 (V2V) 场景下的可行性。

当前阶段实现了 **IEEE 802.11p 协议栈的软件回环仿真**。我们构建了一个纯净的 GNU Radio 虚拟基站，去除了繁杂的网卡配置和抓包工具依赖，通过 UDP 接口直接打通了上层 Python 应用（Raft 算法逻辑）与底层物理层的通信链路。

## 核心文件说明

本项目仅依赖以下 **3 个核心文件** 即可运行：

### 1. `wifi_transceiver.py` (虚拟基站 / 物理层主程序)
* **来源**: 修改自 `gr-ieee802-11`。
* **架构修改**:
    * **通信接口**: 移除了对 TAP 虚拟网卡的依赖，改为使用 **UDP Socket**。
        * **入口 (RX)**: 监听 `127.0.0.1:12345`，接收 Python 发送的数据帧。
        * **出口 (TX)**: 向 `127.0.0.1:54321` 转发解调后的数据帧。
    * **信道模拟**: 移除了 `UHD: USRP` 硬件模块，替换为 `Channel Model`，实现了软件内的信号回环。
* **作用**: 它是整个系统的“空气”和“物理层”，负责将数据在数字信号和 802.11p 协议帧之间转换。

### 2. `wifi_phy_hier.py` (物理层逻辑核心)
* **来源**: 生成自 `gr-ieee802-11` 的层级块。
* **依赖关系**: 这是 `wifi_transceiver.py` 的硬性依赖。它封装了 OFDM 调制、解调、同步等复杂的信号处理逻辑。
* **部署**: 必须与主程序放置在同一目录下。

### 3. `test.py` (上层应用 / 车载终端)
* **来源**: 原创。
* **作用**: 模拟 V2V 网络中的车辆节点。
    * **发送**: 将字符串/JSON数据打包，通过 UDP 发送给虚拟基站。
    * **接收**: 监听 UDP 端口，接收来自虚拟基站广播的消息。
    * **逻辑**: 未来 Raft 共识算法（Leader 选举、日志复制）将在此文件中实现。

---

## 环境依赖

* **操作系统**: Ubuntu 20.04 / 22.04 LTS
* **Python**: Python 3.8+
* **GNU Radio**: 3.8 或 3.10 版本
* **OOT 模块**: [gr-ieee802-11](https://github.com/bastibl/gr-ieee802-11) (及其依赖 gr-foo) 需编译安装

---

## 快速运行

**1. 启动虚拟基站**\
打开第一个终端窗口，直接运行主程序：
```bash
python3 scripts/wifi_transceiver.py
```

**2. 启动通信测试**\
打开第二个终端窗口，运行测试脚本：
```bash
python3 scripts/test.py
```

**3. 预期结果**\
在 test.py 的窗口中，你应该能看到类似以下的交互日志，证明全链路已打通：
```Plaintext
正在监听 54321...
[-->] 发送给基站: b'Hello V2V 0'
[<--] 收到回信: Hello V2V 0
[-->] 发送给基站: b'Hello V2V 1'
[<--] 收到回信: Hello V2V 1
...
```