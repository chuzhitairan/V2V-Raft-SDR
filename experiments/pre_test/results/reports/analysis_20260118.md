# V2V-SDR 基准测试分析报告

**测试日期**: 2026-01-18  
**测试设备**: ANTSDR E200 (AD9361)  
**测试模式**: 单板自回环 (Self-loopback)  
**RX Gain**: 0.50 (固定)  
**TX Gain 范围**: 0.10 - 0.90 (步长 0.05)  

---

## 📊 关键发现

### 1. 最佳发射增益区间

| 区间 | TX Gain | 丢包率 | SNR | 评价 |
|------|---------|--------|-----|------|
| **最佳工作区** | **0.50 - 0.60** | **0%** | **20-28 dB** | ⭐ 推荐 |
| 可用区 | 0.35 - 0.65 | 0-2% | 8-30 dB | 可接受 |
| 低功率失效区 | < 0.30 | 86-100% | < 4 dB | ❌ 信号过弱 |
| 高功率饱和区 | > 0.70 | 5-95% | ~31 dB | ❌ 接收端饱和 |

### 2. 丢包率突变阈值

| 阈值类型 | TX Gain | 丢包率变化 | SNR | 说明 |
|----------|---------|------------|-----|------|
| **下限阈值** | **0.30 → 0.35** | **86% → 1%** | 3.9 → 8.0 dB | 信号从无到有 |
| **上限阈值** | **0.65 → 0.70** | **1% → 5%** | 29.8 → 30.8 dB | 开始饱和 |
| 严重饱和点 | 0.75 → 0.80 | 15% → 54% | 31.5 → 31.4 dB | 饱和恶化 |

### 3. SNR 与丢包率关系

```
SNR (dB)    丢包率    通信质量
─────────────────────────────
< 4         ~100%     无法通信
4-8         50-86%    极差
8-12        1-2%      可用
12-20       0-2%      良好
20-28       0%        优秀 ⭐
28-31       0-5%      开始饱和
> 31        5-95%     严重饱和
```

### 4. 关键 SNR 阈值

- **最低可用 SNR**: ~8 dB (丢包率 < 5%)
- **可靠通信 SNR**: > 12 dB (丢包率 < 2%)
- **饱和起始 SNR**: ~30 dB (丢包率开始上升)

---

## 📈 详细数据

| TX Gain | 发送 | 接收 | 丢包率 | SNR Mean | SNR Std | SNR Min | SNR Max |
|---------|------|------|--------|----------|---------|---------|---------|
| 0.10 | 100 | 0 | 100.0% | 0.00 | 0.00 | 0.00 | 0.00 |
| 0.15 | 100 | 0 | 100.0% | 0.00 | 0.00 | 0.00 | 0.00 |
| 0.20 | 100 | 0 | 100.0% | 0.00 | 0.00 | 0.00 | 0.00 |
| 0.25 | 100 | 0 | 100.0% | 0.00 | 0.00 | 0.00 | 0.00 |
| 0.30 | 100 | 14 | 86.0% | 3.90 | 1.03 | 2.34 | 5.41 |
| **0.35** | 100 | 99 | **1.0%** | 8.03 | 0.93 | 5.47 | 10.25 |
| 0.40 | 100 | 98 | 2.0% | 12.34 | 1.15 | 9.06 | 14.54 |
| 0.45 | 100 | 98 | 2.0% | 16.66 | 0.93 | 13.60 | 19.00 |
| **0.50** | 100 | 100 | **0.0%** | 20.78 | 0.96 | 17.68 | 22.77 |
| **0.55** | 100 | 100 | **0.0%** | 24.47 | 1.07 | 21.47 | 26.27 |
| **0.60** | 100 | 100 | **0.0%** | 27.61 | 1.54 | 21.42 | 30.93 |
| 0.65 | 100 | 99 | 1.0% | 29.78 | 1.98 | 23.15 | 33.75 |
| 0.70 | 100 | 95 | 5.0% | 30.83 | 2.53 | 22.44 | 35.41 |
| 0.75 | 100 | 85 | 15.0% | 31.47 | 2.59 | 23.60 | 36.22 |
| 0.80 | 100 | 46 | 54.0% | 31.39 | 2.63 | 26.66 | 35.67 |
| 0.85 | 100 | 16 | 84.0% | 30.86 | 2.16 | 28.12 | 34.95 |
| 0.90 | 100 | 5 | 95.0% | 32.64 | 1.95 | 30.93 | 35.45 |

---

## 🔧 Raft 应用建议

基于以上测试结果，对 Raft 共识算法的参数建议：

### 推荐配置 (RX Gain = 0.5)

```python
# 最佳 TX Gain 设置
TX_GAIN_RECOMMENDED = 0.55  # 最佳点

# 自适应增益范围
TX_GAIN_MIN = 0.40  # 最小可用
TX_GAIN_MAX = 0.65  # 最大安全

# SNR 阈值 (用于 RUBICONe 自适应超时)
SNR_EXCELLENT = 20.0   # > 20 dB: 缩短超时
SNR_GOOD = 12.0        # 12-20 dB: 正常超时
SNR_POOR = 8.0         # < 8 dB: 延长超时
SNR_CRITICAL = 4.0     # < 4 dB: 可能丢失连接
```

### 自适应选举超时建议

```python
def calculate_election_timeout(snr_db: float) -> float:
    """基于 SNR 计算选举超时"""
    BASE_TIMEOUT = 150  # ms
    
    if snr_db >= 20:
        return BASE_TIMEOUT * 0.8   # 120 ms
    elif snr_db >= 12:
        return BASE_TIMEOUT         # 150 ms
    elif snr_db >= 8:
        return BASE_TIMEOUT * 1.5   # 225 ms
    else:
        return BASE_TIMEOUT * 2.0   # 300 ms
```

---

## 📁 相关文件

- **数据文件**: `results/csv/auto_benchmark_20260118_173331.csv`
- **图表文件**: `results/plots/auto_benchmark_20260118_173331_plot.png`
- **测试工具**: `scripts/app/full_auto_benchmark.py`
- **绘图工具**: `scripts/app/plot_csv.py`

---

## 📝 备注

1. **饱和现象解释**: TX Gain > 0.65 后，接收端 ADC 饱和，导致信号失真，即使 SNR 数值较高，实际解调成功率下降。

2. **实际部署建议**: 在真实 V2V 场景中，信道衰落会动态变化，建议实现自适应增益控制 (AGC) 或预留 3-6 dB 余量。

3. **后续测试建议**:
   - 测试不同 RX Gain 下的最佳 TX Gain
   - 测试双板通信（非自回环）
   - 测试不同距离/障碍物场景
